<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
    
<mapper namespace="com.project.petcarepedia.repository.HospitalMapper">

	<select id = "Hslist" parameterType="com.project.petcarepedia.dto.PageDto" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY,HRINK, ,gloc ,IMG, HRINK, hsfile1, hsfile2, auth, htime
		FROM (SELECT ROWNUM RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY,  IMG, HRINK,gloc , HRINK, hsfile1, hsfile2, auth, htime
			  FROM( SELECT HID, HNAME,  ANIMAL, NTIME, HOLIDAY,gloc ,IMG, HRINK, hsfile1, hsfile2, auth, htime FROM PCP_HOSPITAL
					where hname like '%'||#{hname}||'%'
					ORDER BY HID))
		WHERE RNO BETWEEN #{startCount} AND #{endCount}
	</select>

	<select id = "Hslist2" parameterType="com.project.petcarepedia.dto.PageDto" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY,IMG, HRINK, gloc ,IMG, HRINK, hsfile1, hsfile2, auth, htime
		FROM (SELECT ROWNUM RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY,  gloc ,IMG, HRINK, hsfile1, hsfile2, auth, htime
			  FROM( SELECT HID, HNAME,  ANIMAL, NTIME, HOLIDAY ,  IMG, HRINK,gloc ,IMG, HRINK, hsfile1, hsfile2, auth , htime FROM PCP_HOSPITAL
					where gloc like '%'||#{gloc}||'%'
					ORDER BY HID))
		WHERE RNO BETWEEN #{startCount} AND #{endCount}
	</select>

	<select id = "Hlist" parameterType="com.project.petcarepedia.dto.PageDto" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY, IMG, gloc, HRINK, auth, htime
		FROM (SELECT ROWNUM RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY ,gloc ,IMG, HRINK, hsfile1, hsfile2, auth, htime
			  FROM( SELECT HID, HNAME,  ANIMAL, NTIME, HOLIDAY ,gloc ,IMG, HRINK,  hsfile1, hsfile2, auth, htime FROM PCP_HOSPITAL
			                                                                                                             ORDER BY HID desc))
		WHERE RNO BETWEEN #{startCount} AND #{endCount}
	</select>

	
	<select id="count" resultType="int">
		select count(*) from pcp_hospital
	</select>

	<select id="Hsfiles" parameterType="String" resultType="String">
		SELECT hsfile1, hsfile2 from pcp_hospital where hid = #{hid}

	</select>

	<select id="list" parameterType="com.project.petcarepedia.dto.PageDto" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY 
					  FROM (SELECT ROWNUM RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY 
						 FROM( SELECT HID, HNAME,  ANIMAL, NTIME, HOLIDAY FROM PCP_HOSPITAL ORDER BY HID  desc )) 
					WHERE RNO BETWEEN #{start} AND #{end}
	</select>
	
	<select id="selectStar" parameterType="String" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT ROUND(AVG(RSTAR),1) RSTAR FROM
				(SELECT * FROM PCP_HOSPITAL h, PCP_REVIEW R WHERE H.HID=R.HID AND H.HID= #{hid} )
	</select>
	
	<select id="searchGloc" parameterType="String" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT HID, HNAME, GLOC, LOC, TEL, HTIME, NTIME, HOLIDAY, ANIMAL, INTRO, IMG, HRINK,X,Y, HSFILE, auth
				 FROM PCP_HOSPITAL where gloc= #{gloc}
	</select>	
	
	<select id="search" parameterType="String" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT HID, HNAME, GLOC, LOC, TEL, HTIME, NTIME, HOLIDAY, ANIMAL,INTRO, IMG, HRINK, X, Y , HFILE, HSFILE, hsfile1, hsfile2, auth
		FROM PCP_HOSPITAL WHERE HNAME LIKE '%'|| #{hname}||'%' and auth='auth'
	</select>
	
	<delete id="delete" parameterType="com.project.petcarepedia.dto.HospitalDto">
		delete from pcp_hospital where hid=#{hid}
	</delete>
	
	<update id="update" parameterType="com.project.petcarepedia.dto.HospitalDto">
		UPDATE PCP_HOSPITAL SET HNAME=#{hname} , GLOC=#{gloc}, LOC =#{loc} , TEL=#{tel}, 
					  HTIME=#{htime} , NTIME=#{ntime} , HOLIDAY=#{holiday}, ANIMAL=#{animal}, 
					  INTRO=#{intro} ,HRINK= #{hrink} , X=#{x}, Y=#{y},
					  hfile1=#{hfile1} , hsfile1=#{hsfile1}, hfile2=#{hfile2}, hsfile2=#{hsfile2}
					   WHERE HID = #{hid}
	</update>


	<select id="content" parameterType="String" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT HID, HNAME, GLOC, LOC, TEL, HTIME, NTIME, HOLIDAY, ANIMAL, INTRO, IMG, HRINK,X,Y, hfile1, hfile2, hsfile1, hsfile2 , auth
		FROM PCP_HOSPITAL WHERE HID = #{hid}
	</select>

	<select id="list2" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT H.HID, H.HNAME, H.GLOC, H.LOC, H.TEL, H.HTIME, SUBSTR(H.HTIME, 0, 5) AS STARTTIME,
			   SUBSTR(H.HTIME, 7, 6) AS ENDTIME, H.NTIME, H.HOLIDAY, H.ANIMAL, H.INTRO, H.IMG, H.HRINK, H.X, H.Y, ROUND(AVG(RSTAR),1) AS RSTAR, H.HSFILE, H.AUTH, H.HSFILE1, H.HSFILE2
		FROM (SELECT HID, HNAME, GLOC, LOC, TEL, HTIME, SUBSTR(HTIME, 0, 5) STARTTIME, SUBSTR(HTIME, 7, 6) ENDTIME,
					 NTIME, HOLIDAY, ANIMAL, INTRO, IMG, HRINK, X, Y , HSFILE, AUTH, HSFILE1, HSFILE2 FROM PCP_HOSPITAL
			  ORDER BY HID DESC) H
				 LEFT JOIN PCP_REVIEW R ON H.HID = R.HID
		GROUP BY H.HID, H.HNAME, H.GLOC, H.LOC, H.TEL, H.HTIME, SUBSTR(H.HTIME, 0, 5), SUBSTR(H.HTIME, 7, 6),
				 H.NTIME, H.HOLIDAY, H.ANIMAL, H.INTRO, H.IMG, H.HRINK, H.X, H.Y , H.HSFILE, H.AUTH, H.HSFILE1, H.HSFILE2
		ORDER BY H.HID
	</select>
	
	<select id="selectTime" parameterType="String" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT HID, HNAME, SUBSTR(HTIME, 0,5 ) STARTTIME,  SUBSTR(HTIME, 7,6 ) ENDTIME 
				 FROM PCP_HOSPITAL WHERE HID= #{hid}
	</select>
	
	<insert id="insert" parameterType="com.project.petcarepedia.dto.HospitalDto">
		INSERT INTO PCP_HOSPITAL (HID, HNAME, GLOC, LOC, TEL, HTIME, NTIME, HOLIDAY, ANIMAL, INTRO, HRINK, X, Y, HFILE1, HSFILE1, HFILE2, HSFILE2) VALUES
					   ('H_'||LTRIM(TO_CHAR(SEQU_PCP_HOSPITAL_HID.NEXTVAL,'0000')), #{hname}, #{gloc}, #{loc}, #{tel}, #{htime}, #{ntime},
					   	 #{holiday}, #{animal}, #{intro}, #{hrink}, #{x}, #{y}, #{hfile1, jdbcType=VARCHAR}, #{hsfile1, jdbcType=VARCHAR},
						#{hfile2, jdbcType=VARCHAR},#{hsfile2, jdbcType=VARCHAR}
					   )
	</insert>

	<!--  manager 추가  -->
	<insert id="manager_insert" parameterType="com.project.petcarepedia.dto.HospitalDto">
		INSERT INTO PCP_HOSPITAL (HID, HNAME, GLOC, LOC, TEL, HTIME, NTIME, HOLIDAY, ANIMAL, INTRO, HRINK, X, Y, HFILE1, HSFILE1, HFILE2, HSFILE2, MID, AUTH)
		VALUES ('H_'||LTRIM(TO_CHAR(SEQU_PCP_HOSPITAL_HID.NEXTVAL,'0000')), #{hname}, #{gloc}, #{loc}, #{tel}, #{htime}, #{ntime}, #{holiday},
		        #{animal}, #{intro}, #{hrink}, #{x}, #{y}, #{hfile1, jdbcType=VARCHAR}, #{hsfile1 , jdbcType=VARCHAR},
		    	#{hfile2, jdbcType=VARCHAR}, #{hsfile2 , jdbcType=VARCHAR}, #{mid}, 'unauth')

	</insert>

	<update id = "manager_update" parameterType="com.project.petcarepedia.dto.HospitalDto">
		UPDATE PCP_HOSPITAL SET HNAME = #{hname}, GLOC=#{gloc}, LOC =#{loc} , TEL=#{tel},
								HTIME=#{htime} , NTIME=#{ntime} , HOLIDAY=#{holiday}, ANIMAL=#{animal},
								INTRO=#{intro} ,HRINK= #{hrink} , X=#{x}, Y=#{y},hfile1=#{hfile1, jdbcType=VARCHAR} , hsfile1=#{hsfile1, jdbcType=VARCHAR}, hfile2=#{hfile2, jdbcType=VARCHAR}, hsfile2=#{hsfile2, jdbcType=VARCHAR}
		WHERE HID = #{hid}
	</update>

	<select id="selectMh" parameterType="String" resultType="com.project.petcarepedia.dto.HospitalDto">
		select hid, hname, loc, gloc, tel, htime, ntime, holiday, animal, intro, img, hrink, x, y, hfile1, hsfile1, hfile2, hsfile2, m.mid, auth
		from pcp_hospital h, pcp_member m
		where h.mid = m.mid and m.mid=#{mid}
	</select>

	<update id="updateMid" parameterType="String">
		update pcp_hospital set mid=null where mid=#{mid}
	</update>

	<select id = "hospitalCheck" parameterType="String" resultType="int">
		select count(*) from pcp_hospital where mid = #{mid}
	</select>


	<!--  auth 추가  -->
	<update id="authUpdate" parameterType="com.project.petcarepedia.dto.HospitalDto">
		update pcp_hospital set auth = 'auth' where hid = #{hid}
	</update>

	<select id="AuthList" parameterType="com.project.petcarepedia.dto.PageDto" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY, IMG, gloc, HRINK, auth, htime
		FROM (SELECT ROWNUM RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY ,gloc ,IMG, HRINK, hsfile1, hsfile2, auth, htime
			  FROM( SELECT HID, HNAME,  ANIMAL, NTIME, HOLIDAY ,gloc ,IMG, HRINK,  hsfile1, hsfile2, auth, htime FROM PCP_HOSPITAL
					ORDER BY auth))
		WHERE RNO BETWEEN #{startCount} AND #{endCount}
	</select>

	<select id="unAuthList" parameterType="com.project.petcarepedia.dto.PageDto" resultType="com.project.petcarepedia.dto.HospitalDto">
		SELECT RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY, IMG, gloc, HRINK, auth, htime
		FROM (SELECT ROWNUM RNO, HID, HNAME,  ANIMAL, NTIME, HOLIDAY ,gloc ,IMG, HRINK, hsfile1, hsfile2, auth, htime
			  FROM( SELECT HID, HNAME,  ANIMAL, NTIME, HOLIDAY ,gloc ,IMG, HRINK,  hsfile1, hsfile2, auth, htime FROM PCP_HOSPITAL
					ORDER BY auth desc))
		WHERE RNO BETWEEN #{startCount} AND #{endCount}
	</select>

	<update id="r1" parameterType="String">
		update pcp_hospital set auth='r1' where hid = #{hid}
	</update>

	<update id="r2" parameterType="String">
		update pcp_hospital set auth='r2' where hid = #{hid}
	</update>

	<update id="r3" parameterType="String">
		update pcp_hospital set auth='r3' where hid = #{hid}
	</update>

	<update id="r4" parameterType="String">
		update pcp_hospital set auth='r4' where hid = #{hid}
	</update>

	<update id="r5" parameterType="String">
		update pcp_hospital set auth='r5' where hid = #{hid}
	</update>

	<select id="authCheck" parameterType="String" resultType="int">
		select count(*) from pcp_hospital where auth like #{auth}||'%' and hid=#{hid}
	</select>

	<select id = "unauthCheck" parameterType="String" resultType="int">
		select count(*) from pcp_hospital where auth = 'unauth' and hid=#{hid}
	</select>
</mapper>